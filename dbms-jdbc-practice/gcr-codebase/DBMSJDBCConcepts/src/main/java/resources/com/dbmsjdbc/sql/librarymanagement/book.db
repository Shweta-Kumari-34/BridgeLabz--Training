 ============================================================
 Problem: Exercise 3 - Advanced Features (Library Management System)
 File: book.db
 Table: book, student, borrow_record
 Database: practice_db
 ============================================================


create database practice_db;
Query OK, 1 row affected (0.08 sec)

mysql> use prctice_db;
ERROR 1049 (42000): Unknown database 'prctice_db'
mysql> use practice_db;
Database changed
mysql> CREATE TABLE book (
     book_id INT PRIMARY KEY AUTO_INCREMENT,
     title VARCHAR(80) NOT NULL,
     author VARCHAR(60),
     genre VARCHAR(40),
     copies_available INT NOT NULL
    );
Query OK, 0 rows affected (0.13 sec)

mysql> CREATE TABLE student (
     student_id INT PRIMARY KEY AUTO_INCREMENT,
     student_name VARCHAR(60) NOT NULL
     );
Query OK, 0 rows affected (0.03 sec)

mysql> CREATE TABLE borrow_record (
     borrow_id INT PRIMARY KEY AUTO_INCREMENT,
     student_id INT,
     book_id INT,
     borrow_date DATE,
     return_date DATE,
     fine_amount DECIMAL(8,2),
     FOREIGN KEY (student_id) REFERENCES student(student_id),
    FOREIGN KEY (book_id) REFERENCES book(book_id)
     );
Query OK, 0 rows affected (0.10 sec)

mysql> DESC book;
+------------------+-------------+------+-----+---------+----------------+
| Field            | Type        | Null | Key | Default | Extra          |
+------------------+-------------+------+-----+---------+----------------+
| book_id          | int         | NO   | PRI | NULL    | auto_increment |
| title            | varchar(80) | NO   |     | NULL    |                |
| author           | varchar(60) | YES  |     | NULL    |                |
| genre            | varchar(40) | YES  |     | NULL    |                |
| copies_available | int         | NO   |     | NULL    |                |
+------------------+-------------+------+-----+---------+----------------+
5 rows in set (0.05 sec)              



mysql> use practice_db;
Database changed
mysql> INSERT INTO books (title, author, genre, copies_available)
     VALUES
     ('Clean Code', 'Robert C. Martin', 'Programming', 10),
     ('Effective Java', 'Joshua Bloch', 'Programming', 7),
     ('Atomic Habits', 'James Clear', 'Self-Help', 15),
     ('The Alchemist', 'Paulo Coelho', 'Fiction', 5);
ERROR 1146 (42S02): Table 'practice_db.books' doesn't exist
mysql>
mysql> CREATE TABLE borrow_record (
     borrow_id INT PRIMARY KEY AUTO_INCREMENT,
     student_id INT,
     book_id INT,
     borrow_date DATE,
     return_date DATE,
     fine_amount DECIMAL(8,2),
     FOREIGN KEY (student_id) REFERENCES student(student_id),
     FOREIGN KEY (book_id) REFERENCES book(book_id)
     );
ERROR 1050 (42S01): Table 'borrow_record' already exists
mysql> DESC book;
+------------------+-------------+------+-----+---------+----------------+
| Field            | Type        | Null | Key | Default | Extra          |
+------------------+-------------+------+-----+---------+----------------+
| book_id          | int         | NO   | PRI | NULL    | auto_increment |
| title            | varchar(80) | NO   |     | NULL    |                |
| author           | varchar(60) | YES  |     | NULL    |                |
| genre            | varchar(40) | YES  |     | NULL    |                |
| copies_available | int         | NO   |     | NULL    |                |
+------------------+-------------+------+-----+---------+----------------+
5 rows in set (0.01 sec)

mysql> INSERT INTO book (title, author, genre, copies_available)
     VALUES
     ('Clean Code', 'Robert C. Martin', 'Programming', 10),
     ('Effective Java', 'Joshua Bloch', 'Programming', 7),
     ('Atomic Habits', 'James Clear', 'Self-Help', 15),
     ('The Alchemist', 'Paulo Coelho', 'Fiction', 5);
Query OK, 4 rows affected (0.02 sec)
Records: 4  Duplicates: 0  Warnings: 0

mysql> INSERT INTO student (student_name)
     VALUES
     ('Ram Kumar'),
     ('Priya Sharma');
Query OK, 2 rows affected (0.02 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql> SELECT * FROM book;
+---------+----------------+------------------+-------------+------------------+
| book_id | title          | author           | genre       | copies_available |
+---------+----------------+------------------+-------------+------------------+
|       1 | Clean Code     | Robert C. Martin | Programming |               10 |
|       2 | Effective Java | Joshua Bloch     | Programming |                7 |
|       3 | Atomic Habits  | James Clear      | Self-Help   |               15 |
|       4 | The Alchemist  | Paulo Coelho     | Fiction     |                5 |
+---------+----------------+------------------+-------------+------------------+
4 rows in set (0.00 sec)


============================================================
 STUDENT BORROWS BOOK + UPDATE INVENTORY
============================================================


mysql> INSERT INTO borrow_record (student_id, book_id, borrow_date, return_date, fine_amount)
     VALUES (1, 2, '2026-02-01', '2026-02-10', 0);
Query OK, 1 row affected (0.01 sec)

mysql> UPDATE book
     SET copies_available = copies_available - 1
     WHERE book_id = 2;
Query OK, 1 row affected (0.01 sec)
Rows matched: 1  Changed: 1  Warnings: 0

mysql> UPDATE borrow_record
     SET fine_amount = DATEDIFF(return_date, borrow_date) > 7
         * (DATEDIFF(return_date, borrow_date) - 7) * 10
     WHERE borrow_id = 1;
Query OK, 0 rows affected (0.01 sec)
Rows matched: 1  Changed: 0  Warnings: 0


 ============================================================
 FINE CALCULATION (Late return > 7 days, Rs.10/day)
 ============================================================


mysql> SELECT * FROM borrow_record;
+-----------+------------+---------+-------------+-------------+-------------+
| borrow_id | student_id | book_id | borrow_date | return_date | fine_amount |
+-----------+------------+---------+-------------+-------------+-------------+
|         1 |          1 |       2 | 2026-02-01  | 2026-02-10  |        0.00 |
+-----------+------------+---------+-------------+-------------+-------------+
1 row in set (0.00 sec)

 ============================================================
 SEARCH WITH MULTIPLE FILTERS (GENRE + AUTHOR)
 ==========================================================

mysql> SELECT *
     FROM book
     WHERE genre = 'Programming'
     AND author LIKE '%Bloch%';
+---------+----------------+--------------+-------------+------------------+
| book_id | title          | author       | genre       | copies_available |
+---------+----------------+--------------+-------------+------------------+
|       2 | Effective Java | Joshua Bloch | Programming |                6 |
+---------+----------------+--------------+-------------+------------------+
1 row in set (0.01 sec)

====================================================================
Search Available Books (> 0 copies)
====================================================================

mysql> SELECT title, copies_available
     FROM book
     WHERE copies_available > 0;
+----------------+------------------+
| title          | copies_available |
+----------------+------------------+
| Clean Code     |               10 |
| Effective Java |                6 |
| Atomic Habits  |               15 |
| The Alchemist  |                5 |
+----------------+------------------+
4 rows in set (0.00 sec)

mysql>


